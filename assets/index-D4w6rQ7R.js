(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const z=[10,10,10,10,9,9,9,8],H=75,kt=["pink","purple","green","red","blue","orange","silver","gold"],Jt=["Pink","Purple","Green","Red","Blue","Orange","Silver","Gold"],xt=["crypto","zodiac","cards","dice"],Qt={crypto:["xrp","tron","sui","monero","solana","chainlink","ethereum","bitcoin"],zodiac:["aries","taurus","gemini","cancer","leo","libra","sagittarius","aquarius"],cards:["club","diamond","heart","spade","horseshoe","cashsack","king","ace"],dice:["1","2","3","4","5","6","7","8"]},Zt={crypto:["WWXRP","Tron","Sui","Monero","Solana","Chainlink","Ethereum","Bitcoin"],zodiac:["Aries","Taurus","Gemini","Cancer","Leo","Libra","Sagittarius","Aquarius"],cards:["Club","Diamond","Heart","Spade","Horseshoe","Cashsack","King","Ace"],dice:["1","2","3","4","5","6","7","8"]},te=[3,4,5,6,0,2,1,7];function ee(t,e){return t==="cards"?te[e]??e:e}function Nt(t,e,n){const a=xt[t],o=ee(a,e),s=Qt[a][e],r=kt[n];return`/badges-circular/${a}_0${o}_${s}_${r}.svg`}const At=0,ne=1,oe=2,ae=3,ot=["None","ETH","BURNIE","DGNRS"],se=0,at=3,J=["ETH","BURNIE","DGNRS","WWXRP"],_t=[0,0,189,500,1778,6667,31100,155600,355600],re=1e7,ie=400,E={MIN_SCORE:0,MID_SCORE:7500,HIGH_SCORE:25500,MAX_SCORE:35500},R={MIN:9e3,MID:9500,HIGH:9950,MAX:9990},ce=500,et=9e3,St=10990,le=1e6,ue=144136,de=900848,fe=4206141,me=97914359,pe=344701627,he=871470,ge=1e6,S={LEVEL_STREAK_MAX:50,LEVEL_STREAK_BPS:100,MINT_COUNT_MAX:25,MINT_COUNT_BPS:100,QUEST_STREAK_MAX:100,QUEST_STREAK_BPS:100,AFFILIATE_BPS:100,TROPHY_MAX:5,TROPHY_BPS:1e3,DEITY_PASS_BPS:8e3,WHALE_BUNDLE_SMALL_BPS:1e3,WHALE_BUNDLE_LARGE_BPS:4e3};class Ee{state;constructor(e=BigInt(Date.now())){this.state=[e,e^BigInt("0xdeadbeefcafebabe")];for(let n=0;n<20;n++)this.next()}next(){let e=this.state[0];const n=this.state[1];return this.state[0]=n,e^=e<<23n,e^=e>>17n,e^=n,e^=n>>26n,this.state[1]=e,this.state[0]+this.state[1]&(1n<<64n)-1n}nextInRange(e){return Number(this.next()%BigInt(e))}nextFloat(){return Number(this.next()%(1n<<53n))/Number(1n<<53n)}}let ye=new Ee;function C(t){return ye.nextInRange(t)}function _e(t){const e=t%H;let n=0;for(let a=0;a<z.length;a++)if(n+=z[a],e<n)return a;return 7}function bt(){return _e(C(H))}function V(t){return{quadrant:t,color:bt(),symbol:bt()}}function ut(t=!0){const e=[V(0),V(1),V(2),V(3)];let n;if(t)n=1+C(3);else{const a=C(100);a===0?n=ne:a===1?n=oe:a===2?n=ae:n=At}return{traits:e,special:n}}function dt(t,e){let n=0;for(let a=0;a<4;a++)t.traits[a].color===e.traits[a].color&&n++,t.traits[a].symbol===e.traits[a].symbol&&n++;return n}function Ot(t,e){return t!==At&&t===e}function Se(){return{levelStreak:0,mintCount:0,questStreak:0,affiliateBonus:0,trophyCount:0,hasDeityPass:!1,whaleBundleType:"none"}}function Dt(t){let e=0;return e+=Math.min(t.levelStreak,S.LEVEL_STREAK_MAX)*S.LEVEL_STREAK_BPS,e+=Math.min(t.mintCount,S.MINT_COUNT_MAX)*S.MINT_COUNT_BPS,e+=Math.min(t.questStreak,S.QUEST_STREAK_MAX)*S.QUEST_STREAK_BPS,e+=t.affiliateBonus*S.AFFILIATE_BPS,e+=Math.min(t.trophyCount,S.TROPHY_MAX)*S.TROPHY_BPS,t.hasDeityPass&&(e+=S.DEITY_PASS_BPS),t.whaleBundleType==="small"?e+=S.WHALE_BUNDLE_SMALL_BPS:t.whaleBundleType==="large"&&(e+=S.WHALE_BUNDLE_LARGE_BPS),e}function be(t,e){let n;if(t<=E.MIN_SCORE)n=R.MIN;else if(t<=E.MID_SCORE){const a=t/E.MID_SCORE,o=a*a;n=R.MIN+Math.floor((R.MID-R.MIN)*o)}else if(t<=E.HIGH_SCORE){const a=(t-E.MID_SCORE)/(E.HIGH_SCORE-E.MID_SCORE);n=R.MID+Math.floor((R.HIGH-R.MID)*a)}else if(t<=E.MAX_SCORE){const a=(t-E.HIGH_SCORE)/(E.MAX_SCORE-E.HIGH_SCORE);n=R.HIGH+Math.floor((R.MAX-R.HIGH)*a)}else n=R.MAX;return n}function Ht(t){if(t<=E.MIN_SCORE)return et;if(t>=E.MAX_SCORE)return St;const e=t/E.MAX_SCORE;return et+Math.floor((St-et)*e)}function Re(t){return(t/100).toFixed(2)+"%"}function Rt(t,e,n=!1){const a=J[e]??"",o=n?0:2;return`${t.toLocaleString(void 0,{minimumFractionDigits:o,maximumFractionDigits:o})} ${a}`.trim()}function nt(t,e=!1){if(!Number.isFinite(t))return"n/a";const n=e?0:2;return`x${t.toLocaleString(void 0,{minimumFractionDigits:n,maximumFractionDigits:n})}`}function Te(t,e){const n=t.reduce((o,[s])=>Math.max(o,s.length),0),a=t.map(([o,s])=>`${o.padEnd(n," ")} | ${s}`);if(e&&a.length>=2){const o=a.reduce((r,i)=>Math.max(r,i.length),0),s="-".repeat(o);a.splice(a.length-1,0,s)}return a.join(`
`)}function Tt(t,e){return t<5?0:t===8?e?9:8:t}function It(t,e){let n=0;return t===5?n=ue:t===6?n=de:t===7?n=fe:t===8?n=me:t===9&&(n=pe),n===0?0:Math.floor(e*n/le)}function Ie(t){let e=1;const n=Math.pow(10/H,8);for(const a of t.traits)e*=z[a.color]/H,e*=z[a.symbol]/H;return n/e}function Ce(t,e,n,a,o,s,r=0){const i=dt(t,e),c=Ot(t.special,e.special);let l,u=!1;if(i===8&&c)l=re,u=!0;else if(c){const I=Math.min(i+1,8);l=Math.max(_t[I],ie)}else l=_t[i];let d=a;if(o===at&&r>a){const I=Tt(i,c);if(I!==0){const D=r-a,G=It(I,D);d=a+G}}else if(o===se){const I=Tt(i,c);if(I!==0){const D=It(I,ce);d=a+D}}let f=n*l*d/(100*1e4);const _=Ie(t);f=f*_,o!==at&&(f=f*he/ge);const m=d/1e4,T=l/100,h=f<=0,g=c?"Special":`${i} ${i===1?"match":"matches"}`,L=Math.abs(f)>=100,O=[[Rt(n,o,L),"Bet"],[nt(T,L),g]];h||O.push([nt(m,L),"Activity score"],[nt(_,L),"Difficulty"],[Rt(f,o,L),"Payout"]);const tt=Te(O,!h);return{matches:i,specialMatch:c,payoutMultiplierBps:l,payout:f,playerTicket:t,resultTicket:e,isJackpot:u,math:tt}}function ve(t,e){const n={0:.01,1:500,2:0,3:20};return e===2?!1:t>=n[e]}const Wt=1,qt=2,Ut=3,st=4,Pe=[{chance:1,multiplier:4.6},{chance:4,multiplier:2.3},{chance:20,multiplier:1.1},{chance:45,multiplier:.651},{chance:30,multiplier:.45}],Ct=[{chance:795,ppmPerEth:10,tier:"small"},{chance:150,ppmPerEth:390,tier:"medium"},{chance:50,ppmPerEth:800,tier:"large"},{chance:5,ppmPerEth:8e3,tier:"mega"}],Y={low:{baseBps:3e3,stepBps:250},high:{baseBps:15525,stepBps:5e3}},vt=1e6;function Be(t,e){const n=C(20);return n<=10?$e(t,e,n):n<=12?we(t,n):n<=14?Le(n):Me(t,e,n)}let Pt=1;function $e(t,e,n){const a=t*.1272,o=C(100);let s=0,r=.45,i="small";for(const m of Pe)if(s+=m.chance,o<s){r=m.multiplier,m.multiplier>=4?i="mega":m.multiplier>=2?i="large":m.multiplier>=1?i="medium":i="small";break}const c=a*r,l=.01*(1+Pt*.05),u=Math.max(1,Math.floor(c/l)),d=Pt+1,f=u*l,_=[`lootboxValue = ${t.toFixed(6)} ETH`,`mainRoll = ${n} (0-10 => tickets)`,`budget = lootboxValue * 0.1272 = ${a.toFixed(6)}`,`varianceRoll = ${o} => multiplier ${r}`,`ticketValue = budget * multiplier = ${c.toFixed(6)}`,`ticketPrice = 0.01 * (1 + level*0.05) = ${l.toFixed(6)}`,`ticketCount = floor(ticketValue / ticketPrice) = ${u}`,`ethValue = ticketCount * ticketPrice = ${f.toFixed(6)}`].join(`
`);return{type:Wt,amount:u,description:`${u} ticket${u>1?"s":""} for Lv.${d} (~${f.toFixed(4)} ETH)`,tier:i,ethValue:f,targetLevel:d,math:_}}function we(t,e){const n=C(1e3);let a=0,o=Ct[0];for(const c of Ct)if(a+=c.chance,n<a){o=c;break}const s=t,r=Math.floor(vt*o.ppmPerEth*s/1e6),i=[`lootboxValue = ${t.toFixed(6)} ETH`,`mainRoll = ${e} (11-12 => DGNRS)`,`tierRoll = ${n} => ${o.tier} (${o.ppmPerEth} ppm/ETH)`,"amount = floor(pool * ppm * bet / 1e6)",`= floor(${vt} * ${o.ppmPerEth} * ${s.toFixed(6)} / 1e6)`,`= ${Math.floor(r).toLocaleString()}`].join(`
`);return{type:qt,amount:Math.max(1,r),description:`${r.toLocaleString()} DGNRS`,tier:o.tier,math:i}}function Le(t){const e=["lootboxValue = n/a",`mainRoll = ${t} (13-14 => WWXRP)`,"amount = 1"].join(`
`);return{type:Ut,amount:1,description:"1 WWXRP",tier:"small",math:e}}function Me(t,e,n){const a=C(20);let o,s,r;if(a<16){o=Y.low.baseBps,s=Y.low.stepBps;const i=C(16),c=o+s*i,l=t*c/1e4;r=c>5e3?"medium":"small";const u=l*1e3,d=[`lootboxValue = ${t.toFixed(6)} ETH`,`mainRoll = ${n} (15-19 => BURNIE)`,`pathRoll = ${a} (low)`,`stepRoll = ${i}`,`multiplierBps = ${c}`,`amountETH = bet * multiplierBps / 10000 = ${l.toFixed(6)}`,`burnie = amountETH * 1000 = ${Math.floor(u)}`].join(`
`);return{type:st,amount:Math.floor(u),description:`${Math.floor(u).toLocaleString()} BURNIE`,tier:r,math:d}}else{o=Y.high.baseBps,s=Y.high.stepBps;const i=C(4),c=o+s*i,l=t*c/1e4;r=c>25e3?"mega":"large";const u=l*1e3,d=[`lootboxValue = ${t.toFixed(6)} ETH`,`mainRoll = ${n} (15-19 => BURNIE)`,`pathRoll = ${a} (high)`,`stepRoll = ${i}`,`multiplierBps = ${c}`,`amountETH = bet * multiplierBps / 10000 = ${l.toFixed(6)}`,`burnie = amountETH * 1000 = ${Math.floor(u)}`].join(`
`);return{type:st,amount:Math.floor(u),description:`${Math.floor(u).toLocaleString()} BURNIE`,tier:r,math:d}}}function ke(){return{balance:{0:10,1:1e5,2:1e4,3:1e3},activity:Se(),totalBets:0,totalWins:0,biggestWin:0}}function xe(t,e){const n=t.amountPerTicket*t.ticketCount;if(e.balance[t.currency]<n)return null;e.balance[t.currency]-=n,e.totalBets++,e.activity.affiliateBonus=Math.min(e.activity.affiliateBonus+1,100);const a=Dt(e.activity),o=be(a,t.currency);return Ne(t,e,o,n,a)}function Ne(t,e,n,a,o){if(t.ticketCount!==1||t.ticket.special<1||t.ticket.special>3)return null;const s=[];let r=0,i=0,c=!1;const l=Ht(o);for(let m=0;m<t.ticketCount;m++){const T=t.ticket,h=ut(!1),g=Ce(T,h,t.amountPerTicket,n,t.currency,o,l);s.push(g),r+=g.payout,g.isJackpot&&(c=!0),g.matches<=1&&ve(t.amountPerTicket,t.currency)&&i++}const u=r-a;let d=null,f=0,_;if(t.currency===0&&u>0){f=u*.75;const m=a+u*.25;_=m,e.balance[t.currency]+=m,d=Be(f,t.currency),Ae(e,d)}else e.balance[t.currency]+=r;return e.balance[3]+=i,u>0&&(e.totalWins++,u>e.biggestWin&&(e.biggestWin=u)),{mode:1,results:s,totalBet:a,totalPayout:r,netResult:u,consolationPrize:i,hasJackpot:c,lootboxPrize:d,currency:t.currency,amountPerTicket:t.amountPerTicket,ticketCount:t.ticketCount,lootboxValue:f>0?f:void 0,ethPayout:_}}function Ae(t,e){switch(e.type){case Wt:t.balance[0]+=e.amount*.01;break;case qt:t.balance[2]+=e.amount;break;case Ut:t.balance[3]+=e.amount;break;case st:t.balance[1]+=e.amount;break}}function Oe(t,e){const n=J[e];return e===0?t.toFixed(4)+" "+n:t.toLocaleString(void 0,{maximumFractionDigits:2})+" "+n}const Bt={};let ft=ke(),w=null,mt=null;const pt=at;let v=null,ht=!1,b=!1;const F=Bt?.VITE_API_BASE||Bt?.VITE_DISCORD_API_BASE||"http://localhost:8787";let P=null;const rt="degenerette_referrer_code",De=Array.from({length:8},(t,e)=>e),He=[0,1,2,3,4,5,6,7];function Ft(){return{traits:[{quadrant:0,color:0,symbol:0},{quadrant:1,color:0,symbol:0},{quadrant:2,color:0,symbol:0},{quadrant:3,color:0,symbol:0}],special:1}}let p=Ft();const W=[];let X=null,it=[];const Xt=t=>document.getElementById(t);function We(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"&#10;")}function qe(t){return t?` data-tooltip="${We(t)}"`:""}function Gt(t){const e=t.results[t.results.length-1];return e?.math?e.math:""}function Ue(t){if(!t.lootboxPrize)return;const e=[];return t.currency===0&&t.netResult>0&&t.lootboxValue&&e.push(`${Oe(t.lootboxValue,t.currency)} | lootbox value`),e.push(`${t.lootboxPrize.description} | lootbox prize`),e.join(`
`)}function Fe(){try{const t=localStorage.getItem(rt);return t?t.toUpperCase():null}catch{return null}}function Vt(t){try{if(!t){localStorage.removeItem(rt);return}localStorage.setItem(rt,t.toUpperCase())}catch{}}function Xe(){const t=new URLSearchParams(window.location.search),e=t.get("ref")||t.get("referral")||t.get("code");if(!e)return;const n=e.trim().toUpperCase();n&&Vt(n),t.delete("ref"),t.delete("referral"),t.delete("code");const a=t.toString(),o=`${window.location.pathname}${a?`?${a}`:""}${window.location.hash}`;window.history.replaceState({},"",o)}function Ge(){Xe(),p=Ft(),gt(),U(),tn(),Ze(),Ye(),Ke(),Je(),Q(),Z(),Ve(),Et()}async function N(t,e={}){const n=await fetch(`${F}${t}`,{...e,credentials:"include",headers:{"Content-Type":"application/json",...e.headers||{}}});if(!n.ok){const a=await n.text();throw new Error(a||"Request failed")}return n.status===204?null:n.json()}function q(t){w=t,mt=t.activity_score_bps??0,v=t.eth_address??null,gt(),U(),j(),$(),Et(),t?.referrer_code&&Vt(null)}async function Ve(){try{const t=await N("/api/player");q(t.player)}catch{}}function Ye(){const t=document.getElementById("wallet-connect-btn");t&&(t.addEventListener("click",async()=>{if(t.disabled)return;const e=t.querySelector(".btn-text"),n=e?.textContent??t.textContent;if(v){try{await N("/api/wallet/logout",{method:"POST"})}catch{}v=null,w=null,mt=null,j();return}const a=window.ethereum;if(!a){alert("No Ethereum wallet detected.");return}try{t.disabled=!0,e?e.textContent="Connecting...":t.textContent="Connecting...";const s=(await a.request({method:"eth_requestAccounts"}))?.[0];if(!s)return;const r=await N("/api/wallet/nonce",{method:"POST",body:JSON.stringify({address:s})}),i=await a.request({method:"personal_sign",params:[r.message,s]}),c=Fe(),l=await N("/api/wallet/verify",{method:"POST",body:JSON.stringify({address:s,signature:i,referrerCode:c})});q(l.player)}catch(o){console.warn("Wallet connection rejected",o);let s="Wallet connection failed. Please try again.";if(o instanceof Error)s=o.message;else if(o&&typeof o=="object"&&"message"in o){const r=o.message;typeof r=="string"&&(s=r)}alert(s),j()}finally{t.disabled=!1,e?e.textContent=n||"Connect Wallet":t.textContent=n||"Connect Wallet"}}),j())}function j(){const t=document.getElementById("wallet-connect-btn"),e=document.getElementById("wallet-address");if(!t||!e)return;const n=t.querySelector(".btn-text");if(!v){n?n.textContent="Connect Wallet":t.textContent="Connect Wallet",e.textContent="Not connected",$();return}const a=`${v.slice(0,6)}...${v.slice(-4)}`;n?n.textContent="Disconnect":t.textContent="Disconnect",e.textContent=a,$()}function Ke(){const t=document.getElementById("discord-connect-btn");t&&(t.addEventListener("click",async()=>{if(P){await ze();return}window.location.href=`${F}/auth/discord`}),je())}async function je(){try{const t=await fetch(`${F}/auth/discord/me`,{credentials:"include"});if(!t.ok)throw new Error("Not connected");P=(await t.json())?.user??null}catch{P=null}Yt()}async function ze(){try{await fetch(`${F}/auth/discord/logout`,{method:"POST",credentials:"include"})}catch{}P=null,Yt()}function Yt(){const t=document.getElementById("discord-connect-btn"),e=document.getElementById("discord-user"),n=document.getElementById("discord-avatar"),a=document.getElementById("discord-name");if(!(!t||!e||!n||!a)){if(!P){t.textContent="Connect Discord",e.classList.add("hidden"),$();return}t.textContent="Disconnect",a.textContent=P.username,n.src=P.avatarUrl,e.classList.remove("hidden"),$()}}function Je(){const t=document.getElementById("referral-action");t&&(t.addEventListener("click",async()=>{const e=document.getElementById("referral-link");if(!e)return;if((t.dataset.mode||"create")==="copy"){if(e.value)try{await navigator.clipboard.writeText(e.value),t.textContent="Copied",window.setTimeout(()=>{$()},1200)}catch{}return}if(!v||!P){alert("Connect wallet and Discord to create a referral code.");return}try{t.disabled=!0;const a=await N("/api/referral/create",{method:"POST"});w&&(w.referral_code=a.referral_code),$()}catch(a){console.error("Referral create failed",a),alert("Unable to create referral code. Please try again.")}finally{t.disabled=!1}}),$())}function $(){const t=document.getElementById("referral-row"),e=document.getElementById("referral-link"),n=document.getElementById("referral-action");if(!t||!e||!n)return;const a=!!(v&&P);if(t.classList.toggle("hidden",!a),!a)return;const o=w?.referral_code;if(o){const s=`${window.location.origin}${window.location.pathname}?ref=${o}`;e.value=s,n.textContent="Copy",n.dataset.mode="copy"}else e.value="",e.placeholder="Create referral link",n.textContent="Create",n.dataset.mode="create"}function gt(){const t=document.getElementById("currency-balance");if(!t)return;const e=w?w.balance_wwxrp:ft.balance[pt],n=Math.floor(e);t.textContent=n.toLocaleString(void 0,{maximumFractionDigits:0})}function Qe(){const t=document.getElementById("leaderboard-list");if(!t)return;if(!it.length){t.innerHTML='<p class="placeholder">No leaderboard data yet</p>';return}const e=it.map((n,a)=>{const o=n.eth_address?`${n.eth_address.slice(0,6)}...${n.eth_address.slice(-4)}`:"Unknown",s=n.discord_name||o,r=n.discord_avatar?`<img class="leaderboard-avatar" src="${n.discord_avatar}" alt="${s}" />`:'<div class="leaderboard-avatar"></div>',i=Math.floor(n.balance_wwxrp).toLocaleString(void 0,{maximumFractionDigits:0});return`
      <div class="leaderboard-item">
        <div class="leaderboard-rank">#${a+1}</div>
        <div class="leaderboard-user">
          ${r}
          <span class="leaderboard-name" title="${s}">${s}</span>
        </div>
        <div class="leaderboard-balance">${i} WWXRP</div>
      </div>
    `}).join("");t.innerHTML=e}async function Et(){try{const t=await fetch(`${F}/api/leaderboard?limit=10`,{credentials:"include"});if(!t.ok)throw new Error("Failed to load leaderboard");const e=await t.json();it=Array.isArray(e?.leaderboard)?e.leaderboard:[],Qe()}catch(t){console.warn("Leaderboard fetch failed",t)}}function K(){gt()}function Kt(t,e){const a=Math.abs(t)>=100?0:e===0?4:1;return t.toLocaleString(void 0,{maximumFractionDigits:a})}function U(){const t=mt??Dt(ft.activity),e=Ht(t),n=document.getElementById("activity-score");n&&(n.textContent=`${Math.floor(t/100)}%`,n.setAttribute("data-tooltip",`ROI: ${Re(e)}`))}function Ze(){const t=document.getElementById("spin-full");t?.addEventListener("click",Mt),t?.addEventListener("dblclick",n=>{n.preventDefault(),b=!0,ht||Mt()});const e=document.getElementById("ft-amount");e?.addEventListener("change",()=>{const n=parseFloat(e.value);if(!Number.isFinite(n))return;const a=Math.max(1,Math.round(n));e.value=a.toString()})}let y=null,x=null;function tn(){const t=document.getElementById("ft-player");t&&(t.addEventListener("click",e=>{const n=e.target,a=n.closest(".gamepiece-special-container");if(a){$t("specials",void 0,a);return}const o=n.closest(".gp-quadrant");if(!o||!o.dataset.quadrant)return;const s=parseInt(o.dataset.quadrant,10);$t("quadrant",s,o)}),t.addEventListener("wheel",e=>{const a=e.target.closest(".gp-quadrant");if(!a||!a.dataset.quadrant)return;e.preventDefault();const o=parseInt(a.dataset.quadrant,10),s=a.getBoundingClientRect(),r=e.clientX-s.left-s.width/2,i=e.clientY-s.top-s.height/2,l=Math.hypot(r,i)/(s.width/2),u=e.deltaY>0?1:-1;if(l>=.55){const d=(p.traits[o].color+u+8)%8;p.traits[o].quadrant=o,p.traits[o].color=d}else{const d=(p.traits[o].symbol+u+8)%8;p.traits[o].quadrant=o,p.traits[o].symbol=d}A(),ct()},{passive:!1}),document.addEventListener("click",e=>{const n=document.getElementById("quick-selector");if(!n||n.classList.contains("hidden"))return;const a=e.target;n.contains(a)||x&&x.contains(a)||ct()}),window.addEventListener("resize",()=>{y&&x&&jt(x)}))}function A(){X=null,Q(),Z()}function $t(t,e,n){const a=document.getElementById("quick-selector");if(a){if(y={mode:t,quadrant:e},x=n,a.className=`quick-selector ${t}`,t==="quadrant"&&e!==void 0){const o=xt[e],s=Zt[o],r=p.traits[e].color,i=He.map(l=>{const u=kt[l];return`
        <button data-type="color" data-color="${l}" title="${Jt[l]}">
          <span class="color-swatch" style="background: var(--color-${u});"></span>
        </button>
      `}).join(""),c=De.map(l=>{const u=s[l],d=Nt(e,l,r);return`
        <button data-type="symbol" data-symbol="${l}" title="${u}">
          <span class="symbol-swatch"><img src="${d}" alt="${u}" /></span>
        </button>
      `}).join("");a.innerHTML=`${i}${c}`}else if(t==="specials"){const o=[1,2,3];a.innerHTML=o.map(s=>{const r=en(s);return`
        <button data-special="${s}" title="${ot[s]}">
          <span class="symbol-swatch"><img src="${r}" alt="${ot[s]}" /></span>
        </button>
      `}).join("")}a.classList.remove("hidden"),jt(n),a.querySelectorAll("button").forEach(o=>{o.addEventListener("click",()=>{if(y){if(y.mode==="quadrant"&&y.quadrant!==void 0){const s=o.dataset.type;if(s==="color"){const r=parseInt(o.dataset.color||"0",10);p.traits[y.quadrant].quadrant=y.quadrant,p.traits[y.quadrant].color=r,A()}else if(s==="symbol"){const r=parseInt(o.dataset.symbol||"0",10);p.traits[y.quadrant].quadrant=y.quadrant,p.traits[y.quadrant].symbol=r,A()}}else if(y.mode==="specials"){const s=parseInt(o.dataset.special||"0",10);p.special=s,A()}ct()}})})}}function ct(){const t=document.getElementById("quick-selector");t&&(t.classList.add("hidden"),y=null,x=null)}function jt(t){const e=document.getElementById("quick-selector");if(!e)return;const n=t.getBoundingClientRect(),a=12,o=window.scrollX||window.pageXOffset,s=window.scrollY||window.pageYOffset;let r=n.left+o,i=n.bottom+s+8;const c=o+window.innerWidth-e.offsetWidth-a;r>c&&(r=Math.max(a+o,c));const l=s+window.innerHeight-e.offsetHeight-a;i>l&&(i=n.top+s-e.offsetHeight-8),e.style.left=`${r}px`,e.style.top=`${i}px`}function Q(){const t=document.getElementById("ft-player"),e=document.getElementById("ft-house");if(!t||!e)return;const n=X;if(n&&n.results?.length){const a=n.results[n.results.length-1];t.innerHTML=k(a.playerTicket,"hero",a.resultTicket,!0),e.innerHTML=k(a.resultTicket,"hero",a.playerTicket)}else t.innerHTML=k(p,"hero",void 0,!0),e.innerHTML=lt("hero")}function Z(){const t=document.getElementById("net-result-value"),e=document.getElementById("net-result-box"),n=document.getElementById("net-result-token-value"),a=document.getElementById("net-result-token-unit");if(!t)return;const o=X;if(!o){t.textContent="—",n&&a&&(n.textContent="—",a.textContent=J[pt],n.classList.remove("positive","negative")),e?.classList.remove("has-tooltip"),e?.removeAttribute("data-tooltip");return}o.netResult;const s=o.results[o.results.length-1];let r="—";if(s&&(s.specialMatch?r="Special":typeof s.matches=="number"?r=`${s.matches}`:s.playerTicket&&s.resultTicket&&(r=`${dt(s.playerTicket,s.resultTicket)}`)),t.textContent=r,t.classList.remove("positive","negative"),n&&a){let c=0;if(o.currency===0){const f=o.ethPayout;c=(typeof f=="number"?f:o.totalPayout)-o.totalBet}else c=o.netResult??0;const l=c>0?"+":c<0?"-":"",u=Kt(Math.abs(c),o.currency),d=J[o.currency]??"Token";n.textContent=`${l}${u}`,a.textContent=d,n.classList.toggle("positive",c>0),n.classList.toggle("negative",c<0)}const i=Gt(o);e&&i&&(e.classList.add("has-tooltip"),e.setAttribute("data-tooltip",i))}function zt(t){switch(t){case 1:return"/specials/special_eth.svg";case 2:return"/specials/special_burnie.svg";case 3:return"/specials/special_dgnrs.svg";default:return"/specials/special_none.svg"}}function en(t){return t===2?"/specials/special_burnie_static.svg":zt(t)}function B(t){ht=t;const e=document.getElementById("spin-full");e&&(e.textContent=t?"SKIP":"SPIN",e.disabled=!1)}function nn(t,e,n,a){const o=ut(),s=o.traits.map((r,i)=>{const c={...r,quadrant:i};return e.has(i)&&(c.color=t.traits[i].color),n.has(i)&&(c.symbol=t.traits[i].symbol),c});return o.traits=s,o.special=a?t.special:0,o}function wt(t,e,n,a){return{traits:t.traits.map((o,s)=>({...o,color:e.has(s)?o.color:-1,symbol:n.has(s)?o.symbol:-1})),special:a?t.special:-1}}async function Lt(t,e){const n=document.getElementById("ft-house");if(!n)return;const a=500,o=300,s=550,r=[0,1,2,3,0,1,2,3],i=new Set,c=new Set;let l=!1;const u=()=>{const m=nn(t,i,c,l),T=e?wt(t,i,c,l):void 0,h=e?wt(e,i,c,l):void 0;if(n.innerHTML=k(m,"hero",h),e){const g=document.getElementById("ft-player");g&&(g.innerHTML=k(e,"hero",T,!0))}},d=window.setInterval(u,o);u(),await new Promise(m=>setTimeout(m,a));const f=()=>{i.add(0),i.add(1),i.add(2),i.add(3),c.add(0),c.add(1),c.add(2),c.add(3),l=!0,window.clearInterval(d),u()};if(b){b=!1,f();return}const _=1e3;for(let m=0;m<r.length;m+=1){const T=r[m];if(m<4?i.add(T):c.add(T),u(),b){b=!1,f();return}if(m===3&&(await new Promise(h=>setTimeout(h,_)),b)){b=!1,f();return}m<r.length-1&&await new Promise(h=>setTimeout(h,s))}window.clearInterval(d),l=!0,u()}function Mt(){if(ht){b=!0;return}X=null,Z(),Q();const t=pt,e=Xt("ft-amount"),n=parseFloat(e.value),a=Number.isFinite(n)?Math.max(1,Math.round(n)):NaN;if(isNaN(a)||a<=0){alert("Invalid bet amount");return}if(e.value=a.toString(),!v||!w){const s=xe({ticket:p,ticketCount:1,currency:t,amountPerTicket:a},ft);if(!s){alert("Insufficient balance!");return}const r=s.results[s.results.length-1]?.resultTicket;if(!r){K(),M(s);return}const i=b;if(b=!1,i){K(),U(),M(s);return}B(!0),Lt(r,p).then(()=>{K(),U(),M(s),B(!1)}).catch(()=>{K(),U(),M(s),B(!1)});return}B(!0),N("/api/spin",{method:"POST",body:JSON.stringify({ticket:p,amount:a,currency:t})}).then(async o=>{const s=o.result.results[o.result.results.length-1]?.resultTicket;if(!s){q(o.player),M(o.result),B(!1);return}const r=b;if(b=!1,r){q(o.player),M(o.result),B(!1);return}await Lt(s,p),q(o.player),M(o.result),B(!1)}).catch(o=>{console.error("Spin failed",o);let s="Spin failed. Please try again.";if(o?.message)try{const r=JSON.parse(o.message);r?.error&&(s=r.error)}catch{s=o.message}alert(s),B(!1)})}function k(t,e="small",n,a=!1){const o=e==="mini"?34:e==="small"?52:e==="medium"?70:e==="large"?110:160,s=o*2,r=e==="hero",i=t.traits.map((h,g)=>{const L=Nt(h.quadrant,h.symbol,h.color);let O="";if(n){const G=h.color===n.traits[g].color,yt=h.symbol===n.traits[g].symbol;O=G&&yt?"q-both-match":G||yt?"q-partial-match":""}const tt=a?"interactive":"",I=r?"gamepiece-badge hero-badge":"gamepiece-badge",D=r?"":` style="width:${o}px;height:${o}px;"`;return`<div class="gp-quadrant ${O} ${tt}" data-quadrant="${g}"><img src="${L}" class="${I}" data-q="${g}"${D} /></div>`}).join(""),c=zt(t.special),u=n&&t.special>0&&t.special===n.special?"special-match":"",d=t.special>0?ot[t.special]:"Flame",f=`<div class="gamepiece-special-container ${u}"><img src="${c}" alt="${d}" class="gamepiece-special-icon" /></div>`,_=a?'data-interactive="true"':"",m=r?" gamepiece-hero":"",T=r?"":` style="width:${s}px;height:${s}px;"`;return`<div class="gamepiece-result${m}" ${_}${T}>${i}${f}</div>`}function lt(t="small"){const n=(t==="mini"?34:t==="small"?52:t==="medium"?70:t==="large"?110:160)*2,a=t==="hero",o=Array.from({length:4},()=>'<div class="gp-quadrant empty"></div>').join(""),s=a?" gamepiece-hero":"",r=a?"":` style="width:${n}px;height:${n}px;"`;return`
    <div class="gamepiece-result is-empty${s}"${r}>
      ${o}
      <div class="gamepiece-special-container"></div>
    </div>
  `}function on(t){const e=Gt(t),n=Ue(t),a=n?`${e}
---
${n}`:e,o=t.results[t.results.length-1],s={currency:t.currency,totalBet:t.totalBet,totalPayout:t.totalPayout,netResult:t.netResult,tooltip:a,timestamp:Date.now()};o&&(s.playerTicket=o.playerTicket,s.resultTicket=o.resultTicket),W.unshift(s),W.length>50&&W.pop(),an()}function an(){const t=Xt("results-container");if(W.length===0){t.innerHTML='<p class="placeholder">No history yet</p>';return}const e=W.map((n,a)=>{const o=n.netResult>=0,s=(n.netResult>=0?"+":"")+Kt(n.netResult,n.currency),r=n.tooltip??"";let i="—";n.playerTicket&&n.resultTicket&&(i=Ot(n.playerTicket.special,n.resultTicket.special)?"Special":`${dt(n.playerTicket,n.resultTicket)}`);const c=`
      <div class="history-compare">
        <div class="mini-col">
          <span class="mini-label you-label">You</span>
          ${n.playerTicket?k(n.playerTicket,"small",n.resultTicket):lt("small")}
        </div>
        <div class="history-net-big ${o?"positive":"negative"} has-tooltip"${qe(r)}>${s}</div>
        <div class="mini-col">
          <span class="mini-label matches-label">Matches: ${i}</span>
          ${n.resultTicket?k(n.resultTicket,"small",n.playerTicket):lt("small")}
        </div>
      </div>
    `;return`
      <div class="history-item ${o?"win":"loss"}">
        ${c}
      </div>
    `}).join("");t.innerHTML=`<div class="history-list">${e}</div>`}function M(t){X=t,on(t),Q(),Z(),Et()}function sn(){p=ut(),p.special=1+Math.floor(Math.random()*3),A()}window.__DEGEN__=window.__DEGEN__||{};window.__DEGEN__.randomize=sn;window.__DEGEN__.getCurrentTicket=()=>p;window.__DEGEN__.setTicket=t=>{p=t,A()};Ge();
