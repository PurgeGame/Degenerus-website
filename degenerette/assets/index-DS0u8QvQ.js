(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const tt=[10,10,10,10,9,9,9,8],F=75,qt=["pink","purple","green","red","blue","orange","silver","gold"],ie=["Pink","Purple","Green","Red","Blue","Orange","Silver","Gold"],Wt=["crypto","zodiac","cards","dice"],ce={crypto:["xrp","tron","sui","monero","solana","chainlink","ethereum","bitcoin"],zodiac:["aries","taurus","gemini","cancer","leo","libra","sagittarius","aquarius"],cards:["club","diamond","heart","spade","horseshoe","cashsack","king","ace"],dice:["1","2","3","4","5","6","7","8"]},re={crypto:["WWXRP","Tron","Sui","Monero","Solana","Chainlink","Ethereum","Bitcoin"],zodiac:["Aries","Taurus","Gemini","Cancer","Leo","Libra","Sagittarius","Aquarius"],cards:["Club","Diamond","Heart","Spade","Horseshoe","Cashsack","King","Ace"],dice:["1","2","3","4","5","6","7","8"]},le=[3,4,5,6,0,2,1,7];function ue(t,e){return t==="cards"?le[e]??e:e}function Ut(t,e,n){const a=Wt[t],o=ue(a,e),s=ce[a][e],i=qt[n];return`/badges-circular/${a}_0${o}_${s}_${i}.svg`}const Ft=0,de=1,fe=2,me=3,rt=["None","ETH","BURNIE","DGNRS"],pe=0,lt=3,et=["ETH","BURNIE","DGNRS","WWXRP"],wt=[0,0,189,500,1778,6667,31100,155600,355600],he=1e7,ge=400,_={MIN_SCORE:0,MID_SCORE:7500,HIGH_SCORE:25500,MAX_SCORE:35500},v={MIN:9e3,MID:9500,HIGH:9950,MAX:9990},ye=500,it=9e3,vt=10990,Ee=1e6,_e=144136,be=900848,Se=4206141,Re=97914359,Te=344701627,we=871470,ve=1e6,T={LEVEL_STREAK_MAX:50,LEVEL_STREAK_BPS:100,MINT_COUNT_MAX:25,MINT_COUNT_BPS:100,QUEST_STREAK_MAX:100,QUEST_STREAK_BPS:100,AFFILIATE_BPS:100,TROPHY_MAX:5,TROPHY_BPS:1e3,DEITY_PASS_BPS:8e3,WHALE_BUNDLE_SMALL_BPS:1e3,WHALE_BUNDLE_LARGE_BPS:4e3};class Ce{state;constructor(e=BigInt(Date.now())){this.state=[e,e^BigInt("0xdeadbeefcafebabe")];for(let n=0;n<20;n++)this.next()}next(){let e=this.state[0];const n=this.state[1];return this.state[0]=n,e^=e<<23n,e^=e>>17n,e^=n,e^=n>>26n,this.state[1]=e,this.state[0]+this.state[1]&(1n<<64n)-1n}nextInRange(e){return Number(this.next()%BigInt(e))}nextFloat(){return Number(this.next()%(1n<<53n))/Number(1n<<53n)}}let Ie=new Ce;function I(t){return Ie.nextInRange(t)}function Pe(t){const e=t%F;let n=0;for(let a=0;a<tt.length;a++)if(n+=tt[a],e<n)return a;return 7}function Ct(){return Pe(I(F))}function z(t){return{quadrant:t,color:Ct(),symbol:Ct()}}function nt(t=!0){const e=[z(0),z(1),z(2),z(3)];let n;if(t)n=1+I(3);else{const a=I(100);a===0?n=de:a===1?n=fe:a===2?n=me:n=Ft}return{traits:e,special:n}}function ot(t,e){let n=0;for(let a=0;a<4;a++)t.traits[a].color===e.traits[a].color&&n++,t.traits[a].symbol===e.traits[a].symbol&&n++;return n}function Gt(t,e){return t!==Ft&&t===e}function Be(){return{levelStreak:0,mintCount:0,questStreak:0,affiliateBonus:0,trophyCount:0,hasDeityPass:!1,whaleBundleType:"none"}}function Xt(t){let e=0;return e+=Math.min(t.levelStreak,T.LEVEL_STREAK_MAX)*T.LEVEL_STREAK_BPS,e+=Math.min(t.mintCount,T.MINT_COUNT_MAX)*T.MINT_COUNT_BPS,e+=Math.min(t.questStreak,T.QUEST_STREAK_MAX)*T.QUEST_STREAK_BPS,e+=t.affiliateBonus*T.AFFILIATE_BPS,e+=Math.min(t.trophyCount,T.TROPHY_MAX)*T.TROPHY_BPS,t.hasDeityPass&&(e+=T.DEITY_PASS_BPS),t.whaleBundleType==="small"?e+=T.WHALE_BUNDLE_SMALL_BPS:t.whaleBundleType==="large"&&(e+=T.WHALE_BUNDLE_LARGE_BPS),e}function ke(t,e){let n;if(t<=_.MIN_SCORE)n=v.MIN;else if(t<=_.MID_SCORE){const a=t/_.MID_SCORE,o=a*a;n=v.MIN+Math.floor((v.MID-v.MIN)*o)}else if(t<=_.HIGH_SCORE){const a=(t-_.MID_SCORE)/(_.HIGH_SCORE-_.MID_SCORE);n=v.MID+Math.floor((v.HIGH-v.MID)*a)}else if(t<=_.MAX_SCORE){const a=(t-_.HIGH_SCORE)/(_.MAX_SCORE-_.HIGH_SCORE);n=v.HIGH+Math.floor((v.MAX-v.HIGH)*a)}else n=v.MAX;return n}function Vt(t){if(t<=_.MIN_SCORE)return it;if(t>=_.MAX_SCORE)return vt;const e=t/_.MAX_SCORE;return it+Math.floor((vt-it)*e)}function $e(t){return(t/100).toFixed(2)+"%"}function It(t,e,n=!1){const a=et[e]??"",o=n?0:2;return`${t.toLocaleString(void 0,{minimumFractionDigits:o,maximumFractionDigits:o})} ${a}`.trim()}function ct(t,e=!1){if(!Number.isFinite(t))return"n/a";const n=e?0:2;return`x${t.toLocaleString(void 0,{minimumFractionDigits:n,maximumFractionDigits:n})}`}function Le(t,e){const n=t.reduce((o,[s])=>Math.max(o,s.length),0),a=t.map(([o,s])=>`${o.padEnd(n," ")} | ${s}`);if(e&&a.length>=2){const o=a.reduce((i,c)=>Math.max(i,c.length),0),s="-".repeat(o);a.splice(a.length-1,0,s)}return a.join(`
`)}function Pt(t,e){return t<5?0:t===8?e?9:8:t}function Bt(t,e){let n=0;return t===5?n=_e:t===6?n=be:t===7?n=Se:t===8?n=Re:t===9&&(n=Te),n===0?0:Math.floor(e*n/Ee)}function Me(t){let e=1;const n=Math.pow(10/F,8);for(const a of t.traits)e*=tt[a.color]/F,e*=tt[a.symbol]/F;return n/e}function xe(t,e,n,a,o,s,i=0){const c=ot(t,e),r=Gt(t.special,e.special);let l,u=!1;if(c===8&&r)l=he,u=!0;else if(r){const C=Math.min(c+1,8);l=Math.max(wt[C],ge)}else l=wt[c];let d=a;if(o===lt&&i>a){const C=Pt(c,r);if(C!==0){const U=i-a,K=Bt(C,U);d=a+K}}else if(o===pe){const C=Pt(c,r);if(C!==0){const U=Bt(C,ye);d=a+U}}let f=n*l*d/(100*1e4);const S=Me(t);f=f*S,o!==lt&&(f=f*we/ve);const h=d/1e4,k=l/100,p=f<=0,g=r?"Special":`${c} ${c===1?"match":"matches"}`,R=Math.abs(f)>=100,E=[[It(n,o,R),"Bet"],[ct(k,R),g]];p||E.push([ct(h,R),"Activity score"],[ct(S,R),"Difficulty"],[It(f,o,R),"Payout"]);const O=Le(E,!p);return{matches:c,specialMatch:r,payoutMultiplierBps:l,payout:f,playerTicket:t,resultTicket:e,isJackpot:u,math:O}}function Ne(t,e){const n={0:.01,1:500,2:0,3:20};return e===2?!1:t>=n[e]}const jt=1,Yt=2,Kt=3,ut=4,Ae=[{chance:1,multiplier:4.6},{chance:4,multiplier:2.3},{chance:20,multiplier:1.1},{chance:45,multiplier:.651},{chance:30,multiplier:.45}],kt=[{chance:795,ppmPerEth:10,tier:"small"},{chance:150,ppmPerEth:390,tier:"medium"},{chance:50,ppmPerEth:800,tier:"large"},{chance:5,ppmPerEth:8e3,tier:"mega"}],J={low:{baseBps:3e3,stepBps:250},high:{baseBps:15525,stepBps:5e3}},$t=1e6;function Oe(t,e){const n=I(20);return n<=10?De(t,e,n):n<=12?He(t,n):n<=14?qe(n):We(t,e,n)}let Lt=1;function De(t,e,n){const a=t*.1272,o=I(100);let s=0,i=.45,c="small";for(const h of Ae)if(s+=h.chance,o<s){i=h.multiplier,h.multiplier>=4?c="mega":h.multiplier>=2?c="large":h.multiplier>=1?c="medium":c="small";break}const r=a*i,l=.01*(1+Lt*.05),u=Math.max(1,Math.floor(r/l)),d=Lt+1,f=u*l,S=[`lootboxValue = ${t.toFixed(6)} ETH`,`mainRoll = ${n} (0-10 => tickets)`,`budget = lootboxValue * 0.1272 = ${a.toFixed(6)}`,`varianceRoll = ${o} => multiplier ${i}`,`ticketValue = budget * multiplier = ${r.toFixed(6)}`,`ticketPrice = 0.01 * (1 + level*0.05) = ${l.toFixed(6)}`,`ticketCount = floor(ticketValue / ticketPrice) = ${u}`,`ethValue = ticketCount * ticketPrice = ${f.toFixed(6)}`].join(`
`);return{type:jt,amount:u,description:`${u} ticket${u>1?"s":""} for Lv.${d} (~${f.toFixed(4)} ETH)`,tier:c,ethValue:f,targetLevel:d,math:S}}function He(t,e){const n=I(1e3);let a=0,o=kt[0];for(const r of kt)if(a+=r.chance,n<a){o=r;break}const s=t,i=Math.floor($t*o.ppmPerEth*s/1e6),c=[`lootboxValue = ${t.toFixed(6)} ETH`,`mainRoll = ${e} (11-12 => DGNRS)`,`tierRoll = ${n} => ${o.tier} (${o.ppmPerEth} ppm/ETH)`,"amount = floor(pool * ppm * bet / 1e6)",`= floor(${$t} * ${o.ppmPerEth} * ${s.toFixed(6)} / 1e6)`,`= ${Math.floor(i).toLocaleString()}`].join(`
`);return{type:Yt,amount:Math.max(1,i),description:`${i.toLocaleString()} DGNRS`,tier:o.tier,math:c}}function qe(t){const e=["lootboxValue = n/a",`mainRoll = ${t} (13-14 => WWXRP)`,"amount = 1"].join(`
`);return{type:Kt,amount:1,description:"1 WWXRP",tier:"small",math:e}}function We(t,e,n){const a=I(20);let o,s,i;if(a<16){o=J.low.baseBps,s=J.low.stepBps;const c=I(16),r=o+s*c,l=t*r/1e4;i=r>5e3?"medium":"small";const u=l*1e3,d=[`lootboxValue = ${t.toFixed(6)} ETH`,`mainRoll = ${n} (15-19 => BURNIE)`,`pathRoll = ${a} (low)`,`stepRoll = ${c}`,`multiplierBps = ${r}`,`amountETH = bet * multiplierBps / 10000 = ${l.toFixed(6)}`,`burnie = amountETH * 1000 = ${Math.floor(u)}`].join(`
`);return{type:ut,amount:Math.floor(u),description:`${Math.floor(u).toLocaleString()} BURNIE`,tier:i,math:d}}else{o=J.high.baseBps,s=J.high.stepBps;const c=I(4),r=o+s*c,l=t*r/1e4;i=r>25e3?"mega":"large";const u=l*1e3,d=[`lootboxValue = ${t.toFixed(6)} ETH`,`mainRoll = ${n} (15-19 => BURNIE)`,`pathRoll = ${a} (high)`,`stepRoll = ${c}`,`multiplierBps = ${r}`,`amountETH = bet * multiplierBps / 10000 = ${l.toFixed(6)}`,`burnie = amountETH * 1000 = ${Math.floor(u)}`].join(`
`);return{type:ut,amount:Math.floor(u),description:`${Math.floor(u).toLocaleString()} BURNIE`,tier:i,math:d}}}function Ue(){return{balance:{0:10,1:1e5,2:1e4,3:1e3},activity:Be(),totalBets:0,totalWins:0,biggestWin:0}}function Fe(t,e){const n=t.amountPerTicket*t.ticketCount;if(e.balance[t.currency]<n)return null;e.balance[t.currency]-=n,e.totalBets++,e.activity.affiliateBonus=Math.min(e.activity.affiliateBonus+1,100);const a=Xt(e.activity),o=ke(a,t.currency);return Ge(t,e,o,n,a)}function Ge(t,e,n,a,o){if(t.ticketCount!==1||t.ticket.special<1||t.ticket.special>3)return null;const s=[];let i=0,c=0,r=!1;const l=Vt(o);for(let h=0;h<t.ticketCount;h++){const k=t.ticket,p=nt(!1),g=xe(k,p,t.amountPerTicket,n,t.currency,o,l);s.push(g),i+=g.payout,g.isJackpot&&(r=!0),g.matches<=1&&Ne(t.amountPerTicket,t.currency)&&c++}const u=i-a;let d=null,f=0,S;if(t.currency===0&&u>0){f=u*.75;const h=a+u*.25;S=h,e.balance[t.currency]+=h,d=Oe(f,t.currency),Xe(e,d)}else e.balance[t.currency]+=i;return e.balance[3]+=c,u>0&&(e.totalWins++,u>e.biggestWin&&(e.biggestWin=u)),{mode:1,results:s,totalBet:a,totalPayout:i,netResult:u,consolationPrize:c,hasJackpot:r,lootboxPrize:d,currency:t.currency,amountPerTicket:t.amountPerTicket,ticketCount:t.ticketCount,lootboxValue:f>0?f:void 0,ethPayout:S}}function Xe(t,e){switch(e.type){case jt:t.balance[0]+=e.amount*.01;break;case Yt:t.balance[2]+=e.amount;break;case Kt:t.balance[3]+=e.amount;break;case ut:t.balance[1]+=e.amount;break}}function Ve(t,e){const n=et[e];return e===0?t.toFixed(4)+" "+n:t.toLocaleString(void 0,{maximumFractionDigits:2})+" "+n}const zt={enabled:!0,volume:.3};let y=null;const dt={};let Mt=!1;const xt={match1:"/sounds/match1.mp3",match2:"/sounds/match2.mp3",match3:"/sounds/match3.mp3",match4:"/sounds/match4.mp3",match5:"/sounds/match5.mp3",match6:"/sounds/match6.mp3",match7:"/sounds/match7.mp3",match8:"/sounds/match8.mp3",win:"/sounds/win.mp3",lose:"/sounds/lose.mp3",click:"/sounds/click.mp3"},D=[262,294,330,349,392,440,494,523];function $(t,e=.15,n="square"){if(y)try{y.state==="suspended"&&y.resume();const a=y.createOscillator(),o=y.createGain();a.type=n,a.frequency.value=t,o.gain.value=zt.volume*.3,o.gain.exponentialRampToValueAtTime(.001,y.currentTime+e),a.connect(o),o.connect(y.destination),a.start(),a.stop(y.currentTime+e)}catch{}}function je(t){if(y)try{if(y.state==="suspended"&&y.resume(),dt[t]){const n=y.createBufferSource(),a=y.createGain();n.buffer=dt[t],a.gain.value=zt.volume,n.connect(a),a.connect(y.destination),n.start(0);return}const e=t.match(/^match(\d)$/);if(e){const n=parseInt(e[1],10)-1;n>=0&&n<D.length&&$(D[n],.2,"square");return}t==="win"?[0,2,4,7].forEach((n,a)=>{setTimeout(()=>{$(D[n]*2,.2,"square"),a===3&&setTimeout(()=>{$(D[0]*2,.4,"square"),$(D[2]*2,.4,"square"),$(D[4]*2,.4,"square")},100)},a*100)}):t==="lose"?($(300,.15,"sawtooth"),setTimeout(()=>$(200,.3,"sawtooth"),150)):t==="click"&&$(400,.05,"triangle")}catch{}}async function Nt(t,e){if(y)try{const n=await fetch(e);if(!n.ok)return;const a=await n.arrayBuffer();dt[t]=await y.decodeAudioData(a)}catch{}}function Jt(){if(!Mt){Mt=!0;try{y=new(window.AudioContext||window.webkitAudioContext);const t=window.requestIdleCallback;typeof t=="function"?t(()=>{Object.entries(xt).forEach(([e,n])=>{Nt(e,n)})},{timeout:3e3}):setTimeout(()=>{Object.entries(xt).forEach(([e,n])=>{Nt(e,n)})},50),console.debug("[degen] Audio initialized")}catch(t){console.debug("[degen] Audio not available:",t)}}}function Ye(){const t=()=>{Jt(),document.removeEventListener("click",t),document.removeEventListener("keydown",t)};document.addEventListener("click",t,{passive:!0}),document.addEventListener("keydown",t,{passive:!0})}const Ke={chunkSize:6,chunkDelayMs:80};function ze(){const t=[],e=["pink","purple","green","red","blue","orange","silver","gold"],n={crypto:["xrp","tron","sui","monero","solana","chainlink","ethereum","bitcoin"],zodiac:["aries","taurus","gemini","cancer","leo","libra","sagittarius","aquarius"],cards:["club","diamond","heart","spade","horseshoe","cashsack","king","ace"],dice:["1","2","3","4","5","6","7","8"]},a=[3,4,5,6,0,2,1,7];for(const[o,s]of Object.entries(n))s.forEach((i,c)=>{const r=o==="cards"?a[c]:c;e.forEach(l=>{t.push(`/badges-circular/${o}_0${r}_${i}_${l}.svg`)})});return["special_eth","special_burnie","special_burnie_static","special_dgnrs","special_none"].forEach(o=>{t.push(`/specials/${o}.svg`)}),t}async function ft(){const t=ze(),{chunkSize:e,chunkDelayMs:n}=Ke;let a=0;for(let o=0;o<t.length;o+=e)t.slice(o,o+e).forEach(i=>{const c=new Image;c.decoding="async","fetchPriority"in c&&(c.fetchPriority="low"),c.src=i,c.onload=()=>{a++}}),await new Promise(i=>setTimeout(i,n));console.debug(`[degen] Preloaded ${a}/${t.length} badges`)}function Je(){const t=()=>{const e=window.requestIdleCallback;typeof e=="function"?e(()=>ft(),{timeout:2e3}):setTimeout(ft,50)};document.readyState==="complete"?t():window.addEventListener("load",t,{once:!0})}let yt=Ue(),x=null,Et=null;const _t=lt;let P=null,bt=!1,w=!1;const j="https://api.degener.us";let B=null;const mt="degenerette_referrer_code",Qe=Array.from({length:8},(t,e)=>e),Ze=[0,1,2,3,4,5,6,7];function tn(){return{traits:[{quadrant:0,color:0,symbol:0},{quadrant:1,color:0,symbol:0},{quadrant:2,color:0,symbol:0},{quadrant:3,color:0,symbol:0}],special:1}}let m=tn();const G=[];let Y=null,pt=[];const Qt=t=>document.getElementById(t);function en(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"&#10;")}function nn(t){return t?` data-tooltip="${en(t)}"`:""}function Zt(t){const e=t.results[t.results.length-1];return e?.math?e.math:""}function on(t){if(!t.lootboxPrize)return;const e=[];return t.currency===0&&t.netResult>0&&t.lootboxValue&&e.push(`${Ve(t.lootboxValue,t.currency)} | lootbox value`),e.push(`${t.lootboxPrize.description} | lootbox prize`),e.join(`
`)}function an(){try{const t=localStorage.getItem(mt);return t?t.toUpperCase():null}catch{return null}}function te(t){try{if(!t){localStorage.removeItem(mt);return}localStorage.setItem(mt,t.toUpperCase())}catch{}}function sn(){const t=new URLSearchParams(window.location.search),e=t.get("ref")||t.get("referral")||t.get("code");if(!e)return;const n=e.trim().toUpperCase();n&&te(n),t.delete("ref"),t.delete("referral"),t.delete("code");const a=t.toString(),o=`${window.location.pathname}${a?`?${a}`:""}${window.location.hash}`;window.history.replaceState({},"",o)}function cn(){sn(),m=nt(),m.special=1+Math.floor(Math.random()*3),St(),V(),yn(),gn(),un(),dn(),pn(),rn(),at(),st(),ln(),Rt(),Ye(),Je()}function rn(){const t=document.getElementById("randomize-btn");t&&t.addEventListener("click",()=>{se()})}async function q(t,e={}){const n=await fetch(`${j}${t}`,{...e,credentials:"include",headers:{"Content-Type":"application/json",...e.headers||{}}});if(!n.ok){const a=await n.text();let o="Request failed";try{o=JSON.parse(a).error||o}catch{o=a||o}throw new Error(o)}return n.status===204?null:n.json()}function X(t){x=t,Et=t.activity_score_bps??0,P=t.eth_address??null,St(),V(),Z(),M(),Rt(),t?.referrer_code&&te(null)}async function ln(){try{const t=await q("/api/player");X(t.player)}catch{}}function un(){const t=document.getElementById("wallet-connect-btn");t&&(t.addEventListener("click",async()=>{if(t.disabled)return;const e=t.querySelector(".btn-text"),n=e?.textContent??t.textContent;if(P){try{await q("/api/wallet/logout",{method:"POST"})}catch{}P=null,x=null,Et=null,Z();return}const a=window.ethereum;if(!a){alert("No Ethereum wallet detected.");return}try{t.disabled=!0,e?e.textContent="Connecting...":t.textContent="Connecting...";const s=(await a.request({method:"eth_requestAccounts"}))?.[0];if(!s)return;const i=await q("/api/wallet/nonce",{method:"POST",body:JSON.stringify({address:s})}),c=await a.request({method:"personal_sign",params:[i.message,s]}),r=an(),l=await q("/api/wallet/verify",{method:"POST",body:JSON.stringify({address:s,signature:c,referrerCode:r})});X(l.player)}catch(o){console.warn("Wallet connection rejected",o);let s="Wallet connection failed. Please try again.";if(o instanceof Error)s=o.message;else if(o&&typeof o=="object"&&"message"in o){const i=o.message;typeof i=="string"&&(s=i)}alert(s),Z()}finally{t.disabled=!1,e?e.textContent=n||"Connect Wallet":t.textContent=n||"Connect Wallet"}}),Z())}function Z(){const t=document.getElementById("wallet-connect-btn");if(!t)return;const e=t.querySelector(".btn-text");if(!P){e?e.textContent="Connect Wallet":t.textContent="Connect Wallet",M();return}const n=`${P.slice(0,6)}...${P.slice(-4)}`;e?e.textContent=n:t.textContent=n,M()}function dn(){const t=document.getElementById("discord-connect-btn");t&&(t.addEventListener("click",async()=>{if(B){await mn();return}window.location.href=`${j}/auth/discord`}),fn())}async function fn(){try{const t=await fetch(`${j}/auth/discord/me`,{credentials:"include"});if(!t.ok)throw new Error("Not connected");B=(await t.json())?.user??null}catch{B=null}ee()}async function mn(){try{await fetch(`${j}/auth/discord/logout`,{method:"POST",credentials:"include"})}catch{}B=null,ee()}function ee(){const t=document.getElementById("discord-connect-btn");if(!t)return;const e=t.querySelector(".btn-text");if(!B){e?e.textContent="Discord":t.textContent="Discord",M();return}e?e.textContent=B.username:t.textContent=B.username,M()}function pn(){const t=document.getElementById("referral-action");t&&(t.addEventListener("click",async()=>{const e=document.getElementById("referral-link");if(!e)return;if((t.dataset.mode||"create")==="copy"){if(e.value)try{await navigator.clipboard.writeText(e.value),t.textContent="Copied",window.setTimeout(()=>{M()},1200)}catch{}return}if(!P||!B){alert("Connect wallet and Discord to create a referral code.");return}const a=e.value.trim().toUpperCase();if(!a||!/^[A-Z0-9]{3,12}$/.test(a)){alert("Affiliate code must be 3-12 letters or numbers.");return}const o=document.getElementById("rakeback-select"),s=o?parseInt(o.value,10):0;try{t.disabled=!0;const i=await q("/api/affiliate/config",{method:"POST",body:JSON.stringify({code:a,rakebackBps:s})});x&&i.player&&(x.referral_code=i.player.referral_code),M()}catch(i){console.error("Referral create failed",i);const c=i?.message||"Unable to create referral code. Please try again.";alert(c)}finally{t.disabled=!1}}),M())}function M(){const t=document.getElementById("referral-row"),e=document.getElementById("referral-link"),n=document.getElementById("referral-action"),a=document.getElementById("rakeback-select");if(!t||!e||!n)return;const o=!!(P&&B);if(t.classList.toggle("hidden",!o),!o)return;const s=x?.referral_code;if(s){const i=`${window.location.origin}${window.location.pathname}?ref=${s}`;e.value=i,e.readOnly=!0,e.placeholder="",e.classList.remove("needs-input"),n.textContent="Copy",n.dataset.mode="copy",a?.classList.add("hidden")}else e.value="",e.readOnly=!1,e.placeholder="Create referral code",e.classList.add("needs-input"),n.textContent="Create",n.dataset.mode="create",a?.classList.remove("hidden")}function St(){const t=document.getElementById("currency-balance");if(!t)return;const e=x?x.balance_wwxrp:yt.balance[_t],n=Math.floor(e);t.textContent=n.toLocaleString(void 0,{maximumFractionDigits:0})}function hn(){const t=document.getElementById("leaderboard-list");if(!t)return;if(!pt.length){t.innerHTML='<p class="placeholder">No leaderboard data yet</p>';return}const e=pt.map((n,a)=>{const o=n.eth_address?`${n.eth_address.slice(0,6)}...${n.eth_address.slice(-4)}`:"Unknown",s=n.discord_name||o,i=n.discord_avatar?`<img class="leaderboard-avatar" src="${n.discord_avatar}" alt="${s}" />`:'<div class="leaderboard-avatar"></div>',c=Math.floor(n.balance_wwxrp).toLocaleString(void 0,{maximumFractionDigits:0});return`
      <div class="leaderboard-item">
        <div class="leaderboard-rank">#${a+1}</div>
        <div class="leaderboard-user">
          ${i}
          <span class="leaderboard-name" title="${s}">${s}</span>
        </div>
        <div class="leaderboard-balance">${c} WWXRP</div>
      </div>
    `}).join("");t.innerHTML=e}async function Rt(){try{const t=await fetch(`${j}/api/leaderboard?limit=10`,{credentials:"include"});if(!t.ok)throw new Error("Failed to load leaderboard");const e=await t.json();pt=Array.isArray(e?.leaderboard)?e.leaderboard:[],hn()}catch(t){console.warn("Leaderboard fetch failed",t)}}function Q(){St()}function ne(t,e){const a=Math.abs(t)>=100?0:e===0?4:1;return t.toLocaleString(void 0,{maximumFractionDigits:a})}function V(){const t=Et??Xt(yt.activity),e=Vt(t),n=document.getElementById("activity-score");n&&(n.textContent=`${Math.floor(t/100)}%`,n.setAttribute("data-tooltip",`ROI: ${$e(e)}`))}function gn(){const t=document.getElementById("spin-full");t?.addEventListener("click",Ht),t?.addEventListener("dblclick",n=>{n.preventDefault(),w=!0,bt||Ht()});const e=document.getElementById("ft-amount");e?.addEventListener("change",()=>{const n=parseFloat(e.value);if(!Number.isFinite(n))return;const a=Math.max(1,Math.round(n));e.value=a.toString()})}let b=null,H=null;function yn(){const t=document.getElementById("ft-player");t&&(t.addEventListener("click",e=>{const n=e.target,a=n.closest(".gamepiece-special-container");if(a){At("specials",void 0,a);return}const o=n.closest(".gp-quadrant");if(!o||!o.dataset.quadrant)return;const s=parseInt(o.dataset.quadrant,10);At("quadrant",s,o)}),t.addEventListener("wheel",e=>{const a=e.target.closest(".gp-quadrant");if(!a||!a.dataset.quadrant)return;e.preventDefault();const o=parseInt(a.dataset.quadrant,10),s=a.getBoundingClientRect(),i=e.clientX-s.left-s.width/2,c=e.clientY-s.top-s.height/2,l=Math.hypot(i,c)/(s.width/2),u=e.deltaY>0?1:-1;if(l>=.55){const d=(m.traits[o].color+u+8)%8;m.traits[o].quadrant=o,m.traits[o].color=d}else{const d=(m.traits[o].symbol+u+8)%8;m.traits[o].quadrant=o,m.traits[o].symbol=d}W(),ht()},{passive:!1}),document.addEventListener("click",e=>{const n=document.getElementById("quick-selector");if(!n||n.classList.contains("hidden"))return;const a=e.target;n.contains(a)||H&&H.contains(a)||ht()}),window.addEventListener("resize",()=>{b&&H&&oe(H)}))}function W(){Y=null,at(),st()}function At(t,e,n){const a=document.getElementById("quick-selector");if(a){if(b={mode:t,quadrant:e},H=n,a.className=`quick-selector ${t}`,t==="quadrant"&&e!==void 0){const o=Wt[e],s=re[o],i=m.traits[e].color,c=Ze.map(l=>{const u=qt[l];return`
        <button data-type="color" data-color="${l}" title="${ie[l]}">
          <span class="color-swatch" style="background: var(--color-${u});"></span>
        </button>
      `}).join(""),r=Qe.map(l=>{const u=s[l],d=Ut(e,l,i);return`
        <button data-type="symbol" data-symbol="${l}" title="${u}">
          <span class="symbol-swatch"><img src="${d}" alt="${u}" /></span>
        </button>
      `}).join("");a.innerHTML=`${c}${r}`}else if(t==="specials"){const o=[1,2,3];a.innerHTML=o.map(s=>{const i=En(s);return`
        <button data-special="${s}" title="${rt[s]}">
          <span class="symbol-swatch"><img src="${i}" alt="${rt[s]}" /></span>
        </button>
      `}).join("")}a.classList.remove("hidden"),oe(n),a.querySelectorAll("button").forEach(o=>{o.addEventListener("click",()=>{if(b){if(b.mode==="quadrant"&&b.quadrant!==void 0){const s=o.dataset.type;if(s==="color"){const i=parseInt(o.dataset.color||"0",10);m.traits[b.quadrant].quadrant=b.quadrant,m.traits[b.quadrant].color=i,W()}else if(s==="symbol"){const i=parseInt(o.dataset.symbol||"0",10);m.traits[b.quadrant].quadrant=b.quadrant,m.traits[b.quadrant].symbol=i,W()}}else if(b.mode==="specials"){const s=parseInt(o.dataset.special||"0",10);m.special=s,W()}ht()}})})}}function ht(){const t=document.getElementById("quick-selector");t&&(t.classList.add("hidden"),b=null,H=null)}function oe(t){const e=document.getElementById("quick-selector");if(!e)return;const n=t.getBoundingClientRect(),a=12,o=window.scrollX||window.pageXOffset,s=window.scrollY||window.pageYOffset;let i=n.left+o,c=n.bottom+s+8;const r=o+window.innerWidth-e.offsetWidth-a;i>r&&(i=Math.max(a+o,r));const l=s+window.innerHeight-e.offsetHeight-a;c>l&&(c=n.top+s-e.offsetHeight-8),e.style.left=`${i}px`,e.style.top=`${c}px`}function at(){const t=document.getElementById("ft-player"),e=document.getElementById("ft-house");if(!t||!e)return;const n=Y;if(n&&n.results?.length){const a=n.results[n.results.length-1];t.innerHTML=A(a.playerTicket,"hero",a.resultTicket,!0),e.innerHTML=A(a.resultTicket,"hero",a.playerTicket)}else t.innerHTML=A(m,"hero",void 0,!0),e.innerHTML=gt("hero")}function st(){const t=document.getElementById("net-result-value"),e=document.getElementById("net-result-box"),n=document.getElementById("net-result-token-value"),a=document.getElementById("net-result-token-unit");if(!t)return;const o=Y;if(!o){t.textContent="—",n&&a&&(n.textContent="—",a.textContent=et[_t],n.classList.remove("positive","negative")),e?.classList.remove("has-tooltip"),e?.removeAttribute("data-tooltip");return}o.netResult;const s=o.results[o.results.length-1];let i="—";if(s&&(s.specialMatch?i="Special":typeof s.matches=="number"?i=`${s.matches}`:s.playerTicket&&s.resultTicket&&(i=`${ot(s.playerTicket,s.resultTicket)}`)),t.textContent=i,t.classList.remove("positive","negative"),n&&a){let r=0;if(o.currency===0){const f=o.ethPayout;r=(typeof f=="number"?f:o.totalPayout)-o.totalBet}else r=o.netResult??0;const l=r>0?"+":r<0?"-":"",u=ne(Math.abs(r),o.currency),d=et[o.currency]??"Token";n.textContent=`${l}${u}`,a.textContent=d,n.classList.toggle("positive",r>0),n.classList.toggle("negative",r<0)}const c=Zt(o);e&&c&&(e.classList.add("has-tooltip"),e.setAttribute("data-tooltip",c))}function ae(t){switch(t){case 1:return"/specials/special_eth.svg";case 2:return"/specials/special_burnie.svg";case 3:return"/specials/special_dgnrs.svg";default:return"/specials/special_none.svg"}}function En(t){return t===2?"/specials/special_burnie_static.svg":ae(t)}function L(t){bt=t;const e=document.getElementById("spin-full");e&&(e.textContent=t?"SKIP":"SPIN",e.disabled=!1)}function _n(t,e,n,a){const o=nt(),s=o.traits.map((i,c)=>{const r={...i,quadrant:c};return e.has(c)&&(r.color=t.traits[c].color),n.has(c)&&(r.symbol=t.traits[c].symbol),r});return o.traits=s,o.special=a?t.special:0,o}function Ot(t,e,n,a){return{traits:t.traits.map((o,s)=>({...o,color:e.has(s)?o.color:-1,symbol:n.has(s)?o.symbol:-1})),special:a?t.special:-1}}async function Dt(t,e){const n=document.getElementById("ft-house");if(!n)return;const a=500,o=300,s=550,i=[0,1,2,3,0,1,2,3],c=new Set,r=new Set;let l=!1;const u=()=>{const p=_n(t,c,r,l),g=e?Ot(t,c,r,l):void 0,R=e?Ot(e,c,r,l):void 0;if(n.innerHTML=A(p,"hero",R),e){const E=document.getElementById("ft-player");E&&(E.innerHTML=A(e,"hero",g,!0))}},d=window.setInterval(u,o);u(),await new Promise(p=>setTimeout(p,a));const f=()=>{c.add(0),c.add(1),c.add(2),c.add(3),r.add(0),r.add(1),r.add(2),r.add(3),l=!0,window.clearInterval(d),u()};if(w){w=!1,f();return}const S=1e3,h=window.__DEGEN__;let k=0;for(let p=0;p<i.length;p+=1){const g=i[p],R=p<4;if(R?c.add(g):r.add(g),u(),e&&h){const E=e.traits[g],O=t.traits[g];(R?E.color===O.color:E.symbol===O.symbol)?(k++,h.playSound?.(`match${k}`)):h.playSound?.("click")}if(w){w=!1,f();return}if(p===3&&(await new Promise(E=>setTimeout(E,S)),w)){w=!1,f();return}p<i.length-1&&await new Promise(E=>setTimeout(E,s))}window.clearInterval(d),l=!0,u()}function Ht(){if(bt){w=!0;return}Y=null,st(),at();const t=_t,e=Qt("ft-amount"),n=parseFloat(e.value),a=Number.isFinite(n)?Math.max(1,Math.round(n)):NaN;if(isNaN(a)||a<=0){alert("Invalid bet amount");return}if(e.value=a.toString(),!P||!x){const s=Fe({ticket:m,ticketCount:1,currency:t,amountPerTicket:a},yt);if(!s){alert("Insufficient balance!");return}const i=s.results[s.results.length-1]?.resultTicket;if(!i){Q(),N(s);return}const c=w;if(w=!1,c){Q(),V(),N(s);return}L(!0),Dt(i,m).then(()=>{Q(),V(),N(s),L(!1)}).catch(()=>{Q(),V(),N(s),L(!1)});return}L(!0),q("/api/spin",{method:"POST",body:JSON.stringify({ticket:m,amount:a,currency:t})}).then(async o=>{const s=o.result.results[o.result.results.length-1]?.resultTicket;if(!s){X(o.player),N(o.result),L(!1);return}const i=w;if(w=!1,i){X(o.player),N(o.result),L(!1);return}await Dt(s,m),X(o.player),N(o.result),L(!1)}).catch(o=>{console.error("Spin failed",o);let s="Spin failed. Please try again.";if(o?.message)try{const i=JSON.parse(o.message);i?.error&&(s=i.error)}catch{s=o.message}alert(s),L(!1)})}function A(t,e="small",n,a=!1){const o=e==="mini"?34:e==="small"?52:e==="medium"?70:e==="large"?110:160,s=o*2,i=e==="hero",c=t.traits.map((p,g)=>{const R=Ut(p.quadrant,p.symbol,p.color);let E="";if(n){const K=p.color===n.traits[g].color,Tt=p.symbol===n.traits[g].symbol;E=K&&Tt?"q-both-match":K||Tt?"q-partial-match":""}const O=a?"interactive":"",C=i?"gamepiece-badge hero-badge":"gamepiece-badge",U=i?"":` style="width:${o}px;height:${o}px;"`;return`<div class="gp-quadrant ${E} ${O}" data-quadrant="${g}"><img src="${R}" class="${C}" data-q="${g}"${U} /></div>`}).join(""),r=ae(t.special),u=n&&t.special>0&&t.special===n.special?"special-match":"",d=t.special>0?rt[t.special]:"Flame",f=`<div class="gamepiece-special-container ${u}"><img src="${r}" alt="${d}" class="gamepiece-special-icon" /></div>`,S=a?'data-interactive="true"':"",h=i?" gamepiece-hero":"",k=i?"":` style="width:${s}px;height:${s}px;"`;return`<div class="gamepiece-result${h}" ${S}${k}>${c}${f}</div>`}function gt(t="small"){const n=(t==="mini"?34:t==="small"?52:t==="medium"?70:t==="large"?110:160)*2,a=t==="hero",o=Array.from({length:4},()=>'<div class="gp-quadrant empty"></div>').join(""),s=a?" gamepiece-hero":"",i=a?"":` style="width:${n}px;height:${n}px;"`;return`
    <div class="gamepiece-result is-empty${s}"${i}>
      ${o}
      <div class="gamepiece-special-container"></div>
    </div>
  `}function bn(t){const e=Zt(t),n=on(t),a=n?`${e}
---
${n}`:e,o=t.results[t.results.length-1],s={currency:t.currency,totalBet:t.totalBet,totalPayout:t.totalPayout,netResult:t.netResult,tooltip:a,timestamp:Date.now()};o&&(s.playerTicket=o.playerTicket,s.resultTicket=o.resultTicket),G.unshift(s),G.length>50&&G.pop(),Sn()}function Sn(){const t=Qt("results-container");if(G.length===0){t.innerHTML='<p class="placeholder">No history yet</p>';return}const e=G.map((n,a)=>{const o=n.netResult>=0,s=(n.netResult>=0?"+":"")+ne(n.netResult,n.currency),i=n.tooltip??"";let c="—";n.playerTicket&&n.resultTicket&&(c=Gt(n.playerTicket.special,n.resultTicket.special)?"Special":`${ot(n.playerTicket,n.resultTicket)}`);const r=`
      <div class="history-compare">
        <div class="mini-col">
          <span class="mini-label you-label">You</span>
          ${n.playerTicket?A(n.playerTicket,"small",n.resultTicket):gt("small")}
        </div>
        <div class="history-net-big ${o?"positive":"negative"} has-tooltip"${nn(i)}>${s}</div>
        <div class="mini-col">
          <span class="mini-label matches-label">Matches: ${c}</span>
          ${n.resultTicket?A(n.resultTicket,"small",n.playerTicket):gt("small")}
        </div>
      </div>
    `;return`
      <div class="history-item ${o?"win":"loss"}">
        ${r}
      </div>
    `}).join("");t.innerHTML=`<div class="history-list">${e}</div>`}function N(t){Y=t,bn(t),at(),st(),Rt();const e=window.__DEGEN__;if(e){const n=t.results[t.results.length-1];if(n){const a=typeof n.matches=="number"?n.matches:n.playerTicket&&n.resultTicket?ot(n.playerTicket,n.resultTicket):0,o=n.specialMatch,s=t.netResult>0;setTimeout(()=>{o||a>=6||s||a>=3?e.playSound?.("win"):e.playSound?.("lose")},200)}}}function se(){m=nt(),m.special=1+Math.floor(Math.random()*3),W()}window.__DEGEN__=window.__DEGEN__||{};window.__DEGEN__.randomize=se;window.__DEGEN__.getCurrentTicket=()=>m;window.__DEGEN__.setTicket=t=>{m=t,W()};window.__DEGEN__.playSound=je;window.__DEGEN__.initAudio=Jt;window.__DEGEN__.preloadBadges=ft;cn();
